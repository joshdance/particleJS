<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta name="viewport" content="width=device-width; initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="(C) Epistemex">

	<title>Proof-of-concept ParticleJS</title>

	<style>
		body {
			background:#333;
			color:#ccc;
			font:14px sans-serif;
			}

		.options{
			float:right;
			width:500px;
			}
	</style>
</head>
<body>

	<div id="container">
		<header>
			<h1>Proof-of-concept ParticleJS</h1>
		</header>

		<div id="main">
			<canvas id="canvas" width="512" height="256" style="border:1px solid #000;background:#111"></canvas>

			<div class="options">
				<div>
					<label for="rngRate">Birth-rate</label>
					<input id="rngRate" type="range" min="10" max="2000" value="210">
					<output id="outRate">210</output>
				</div>

				<div>
					<label for="rngVel">Velocity</label>
					<input id="rngVel" type="range" min="0" max="1000" value="400">
					<output id="outVel">400</output>
				</div>

				<div>
					<label for="rngSize">Size</label>
					<input id="rngSize" type="range" min="1" max="200" value="200">
					<output id="outSize">200</output>
				</div>

				<div>
					<label for="rngFeather">Feather</label>
					<input id="rngFeather" type="range" min="0" max="50" value="40">
					<output id="outFeather">40</output>
				</div>

				<div>
					<label for="rngOpacity">Opacity</label>
					<input id="rngOpacity" type="range" min="0" max="1000" value="15">
					<output id="outOpacity">0.015</output>
				</div>

				<div>
					<label for="rngSpread">Spread</label>
					<input id="rngSpread" type="range" min="0" max="359" value="45">
					<output id="outSpread">45</output>
				</div>

				<div>
					<label for="rngSpreadA">Spread offset</label>
					<input id="rngSpreadA" type="range" min="0" max="359" value="250">
					<output id="outSpreadA">250</output>
				</div>

				<div>
					<label for="rngWindX">Wind X</label>
					<input id="rngWindX" type="range" min="-50" max="50" value="10">
					<output id="outWindX">0.1</output>
				</div>

				<div>
					<label for="rngWindY">Wind Y</label>
					<input id="rngWindY" type="range" min="-50" max="50" value="50">
					<output id="outWindY">0.7</output>
				</div>

				<div>
					<label for="rngGravY">Gravity Y</label>
					<input id="rngGravY" type="range" min="-500" max="500" value="25">
					<output id="outGravY">0.025</output>
				</div>

			</div>
		</div>

		<footer>

		</footer>
	</div> 	<!-- container -->

<script src="../src/particle.core.js"></script>
<script src="../src/particle.scene.js"></script>
<script src="../src/particle.emitter2D.js"></script>
<script src="../src/particle.particle.js"></script>
<script src="../src/particle.physics.js"></script>
<script src="../src/particle.renderer.canvas.js"></script>
<script src="../src/particle.gradient.js"></script>

<script>

	// create scene
	var scene = new ParticleJS.Scene({
			width: 800,
			height: 400,
			frameBound: false,
			FPS: 30                 // only if frame bound
		}),

		canvas = document.getElementById('canvas'),

		// create renderer and optional gradient
		renderer = new ParticleJS.CanvasRenderer(canvas),
		gradient = new ParticleJS.Gradient(),

		cnt = 0,
		toggle = false,
		mx = 100,
		my = 400;

	// define gradient
	gradient.addStop(0   , '#ff7')
			.addStop(0.1 , '#ff5')
			.addStop(0.11, '#ff7')
			.addStop(0.25, '#f70')
			.addStop(0.67, '#973')
			.addStop(0.75, '#777')
			.addStop(1   , '#333');

	// create emitter
	scene.addEmitter({
		velocity: 400,
		randomVelocity: 60,
		life: 3,
		spread: 45,
		spreadAngle: 290,
		x: 50,
		y: 100,
		birthRate: 210,
		size: 200,
		randomSize: 60,
		feather: 40,
		gradient: gradient,
		r: 150,
		g: 190,
		b: 250,
		opacity: 0.015,
		renderer: renderer,
		preRender: true
	});

	scene.emitters[0].physics.gravityY = -0.025;
	scene.emitters[0].physics.windX = 0.1;
	scene.emitters[0].physics.windY = 0.7;

	//scene.preRoll(250);

	window.onmousemove = function(e) {
		var r = canvas.getBoundingClientRect();
		mx = e.clientX - r.left;
		my = e.clientY - r.top;
	};

	document.getElementById('rngRate').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].birthRate(v);
		document.getElementById('outRate').innerHTML = v;
	}, false);

	document.getElementById('rngVel').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].velocity(v);
		document.getElementById('outVel').innerHTML = v;
	}, false);

	document.getElementById('rngSize').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].size(v);
		document.getElementById('outSize').innerHTML = v;
	}, false);

	document.getElementById('rngOpacity').addEventListener('change', function() {
		var v = this.value * 0.001;
		scene.emitters[0].opacity(v);
		document.getElementById('outOpacity').innerHTML = v.toFixed(3);
	}, false);

	document.getElementById('rngFeather').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].feather(v);
		document.getElementById('outFeather').innerHTML = v;
	}, false);

	document.getElementById('rngSpread').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].spread(v);
		document.getElementById('outSpread').innerHTML = v;
	}, false);

	document.getElementById('rngSpreadA').addEventListener('change', function() {
		var v = this.value;
		scene.emitters[0].spreadAngle(v);
		document.getElementById('outSpreadA').innerHTML = v;
	}, false);

	document.getElementById('rngWindX').addEventListener('change', function() {
		var v = this.value * 0.1;
		scene.emitters[0].physics.windX = v;
		document.getElementById('outWindX').innerHTML = v.toFixed(1);
	}, false);

	document.getElementById('rngWindY').addEventListener('change', function() {
		var v = this.value * 0.1;
		scene.emitters[0].physics.windY = v;
		document.getElementById('outWindY').innerHTML = v.toFixed(1);
	}, false);

	document.getElementById('rngGravY').addEventListener('change', function() {
		var v = this.value * 0.001;
		scene.emitters[0].physics.gravityY = v;
		document.getElementById('outGravY').innerHTML = v.toFixed(3);
	}, false);

	(function loop() {

		//toggle = !toggle;       // run at 30 FPS

		if (toggle) {
			requestAnimationFrame(loop);
			return;
		}

		scene.render();

		scene.emitters[0].x = mx;
		scene.emitters[0].y = my;

		//cnt++;
		if (cnt < 2000) requestAnimationFrame(loop);
	})();

</script>
</body>
</html>
